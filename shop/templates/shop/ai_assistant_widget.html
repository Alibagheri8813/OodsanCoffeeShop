{% load static %}
<!-- Enhanced AI Coffee Assistant Widget -->
<div id="ai-assistant-widget" class="ai-widget-container" style="position: fixed; bottom: 20px; right: 20px; z-index: 1000;">
    <div class="ai-toggle-btn" onclick="toggleAIWidget()">
        <i class="fas fa-robot"></i>
        <span>کافه‌مستر</span>
    </div>
    
    <div id="ai-widget-panel" class="ai-widget-panel" style="display: none;">
        <div class="ai-widget-header">
            <h4><i class="fas fa-coffee"></i> کافه‌مستر</h4>
            <button onclick="toggleAIWidget()" class="close-btn">×</button>
        </div>
        
        <div class="ai-widget-content">
            <div id="ai-chat-messages" class="ai-chat-messages">
                <div class="ai-message">
                    سلام! من کافه‌مستر هستم 🤖☕<br>
                    چطور می‌تونم کمکتون کنم؟
                </div>
            </div>
            
            <div class="ai-input-container">
                <input type="text" id="ai-input" placeholder="سوال خود را بپرسید...">
                <button onclick="sendAIMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
            
            <div class="ai-quick-actions">
                <button onclick="quickAction('menu')" class="quick-btn">منو</button>
                <button onclick="quickAction('recommend')" class="quick-btn">پیشنهاد</button>
                <button onclick="quickAction('order')" class="quick-btn">سفارش</button>
            </div>
        </div>
    </div>
</div>

<style>
.ai-widget-container {
    font-family: 'Vazirmatn', Arial, sans-serif;
    direction: rtl;
}

.ai-toggle-btn {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: white;
    padding: 12px 16px;
    border-radius: 25px;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.ai-toggle-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}

.ai-toggle-btn i {
    font-size: 16px;
}

.ai-widget-panel {
    position: absolute;
    bottom: 70px;
    right: 0;
    width: 350px;
    max-height: 500px;
    background: white;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    overflow: hidden;
}

.ai-widget-header {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: white;
    padding: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.ai-widget-header h4 {
    margin: 0;
    font-size: 16px;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 20px;
    cursor: pointer;
    padding: 0;
    width: 25px;
    height: 25px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.ai-chat-messages {
    height: 250px;
    overflow-y: auto;
    padding: 15px;
    background: #f8f9fa;
}

.ai-message {
    background: #e3f2fd;
    padding: 10px;
    border-radius: 10px;
    margin-bottom: 10px;
    font-size: 14px;
    line-height: 1.4;
}

.user-message {
    background: #c8e6c9;
    text-align: left;
    margin-left: 20px;
}

.ai-input-container {
    padding: 15px;
    display: flex;
    gap: 10px;
    border-top: 1px solid #eee;
}

.ai-input-container input {
    flex: 1;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 20px;
    outline: none;
    font-family: 'Vazirmatn', Arial, sans-serif;
    direction: rtl;
}

.ai-input-container button {
    background: #2c3e50;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 50%;
    cursor: pointer;
    transition: background 0.3s ease;
}

.ai-input-container button:hover {
    background: #34495e;
}

.ai-quick-actions {
    padding: 15px;
    display: flex;
    gap: 8px;
    border-top: 1px solid #eee;
}

.quick-btn {
    background: #f0f0f0;
    border: 1px solid #ddd;
    padding: 8px 12px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.3s ease;
    font-family: 'Vazirmatn', Arial, sans-serif;
}

.quick-btn:hover {
    background: #2c3e50;
    color: white;
}

@media (max-width: 768px) {
    .ai-widget-panel {
        width: 300px;
        right: -25px;
    }
}
</style>

<script>
function toggleAIWidget() {
    const panel = document.getElementById('ai-widget-panel');
    panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

function sendAIMessage() {
    const input = document.getElementById('ai-input');
    const messages = document.getElementById('ai-chat-messages');
    
    if (input.value.trim()) {
        // Add user message
        const userMessage = document.createElement('div');
        userMessage.className = 'ai-message user-message';
        userMessage.textContent = input.value;
        messages.appendChild(userMessage);
        
        // Simulate AI response
        setTimeout(() => {
            const aiResponse = document.createElement('div');
            aiResponse.className = 'ai-message';
            aiResponse.innerHTML = 'درحال پردازش سوال شما... برای تجربه کامل به <a href="/shop/ai-assistant/">صفحه دستیار هوشمند</a> مراجعه کنید.';
            messages.appendChild(aiResponse);
            messages.scrollTop = messages.scrollHeight;
        }, 1000);
        
        input.value = '';
        messages.scrollTop = messages.scrollHeight;
    }
}

function quickAction(action) {
    const messages = document.getElementById('ai-chat-messages');
    let response = '';
    
    switch(action) {
        case 'menu':
            response = 'منوی ما شامل انواع قهوه، نوشیدنی‌های گرم، نوشیدنی‌های سرد و دسر است. <a href="/shop/">مشاهده منو</a>';
            break;
        case 'recommend':
            response = 'امروز قهوه اسپرسو ویژه و کیک شکلاتی را پیشنهاد می‌دهم! ☕🍰';
            break;
        case 'order':
            response = 'برای سفارش ابتدا محصولات را از <a href="/shop/">منو</a> انتخاب کنید.';
            break;
    }
    
    const aiResponse = document.createElement('div');
    aiResponse.className = 'ai-message';
    aiResponse.innerHTML = response;
    messages.appendChild(aiResponse);
    messages.scrollTop = messages.scrollHeight;
}

// Enter key support
document.addEventListener('DOMContentLoaded', function() {
    const input = document.getElementById('ai-input');
    if (input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendAIMessage();
            }
        });
    }
});
</script>