{% extends 'shop/base.html' %}
{% load static %}

{% block title %}{{ page_title }} | Ú©Ø§ÙÛŒ Ø´Ø§Ù¾{% endblock %}

{% block extra_head %}
<style>
/* Recommendations Page Styling */
.recommendations-page {
    background: linear-gradient(135deg, #FFF8F0 0%, #F3E9DC 100%);
    min-height: 100vh;
    padding: 2rem 0;
}

.page-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem 0;
}

.page-title {
    font-size: 3rem;
    font-weight: bold;
    color: #4B2E2B;
    margin-bottom: 1rem;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
}

.page-subtitle {
    font-size: 1.3rem;
    color: #7B3F00;
    max-width: 700px;
    margin: 0 auto;
    line-height: 1.6;
}

.stats-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1.5rem;
    margin-bottom: 3rem;
}

.stat-card {
    background: white;
    padding: 1.5rem;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(75, 46, 43, 0.1);
    text-align: center;
    border: 2px solid transparent;
    transition: all 0.3s ease;
}

.stat-card:hover {
    border-color: #7B3F00;
    transform: translateY(-5px);
    box-shadow: 0 15px 35px rgba(75, 46, 43, 0.2);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: bold;
    color: #4B2E2B;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #7B3F00;
    font-weight: 600;
}

.recommendations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    margin-bottom: 3rem;
}

.recommendation-item {
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(75, 46, 43, 0.1);
    overflow: hidden;
    transition: all 0.3s ease;
    border: 2px solid transparent;
    position: relative;
}

.recommendation-item:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 40px rgba(75, 46, 43, 0.2);
    border-color: #7B3F00;
}

.product-image {
    height: 220px;
    overflow: hidden;
    position: relative;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.recommendation-item:hover .product-image img {
    transform: scale(1.05);
}

.ai-score-badge {
    position: absolute;
    top: 15px;
    right: 15px;
    background: linear-gradient(45deg, #4B2E2B, #7B3F00);
    color: #FFF8F0;
    padding: 8px 15px;
    border-radius: 25px;
    font-size: 0.9rem;
    font-weight: bold;
    box-shadow: 0 4px 15px rgba(75, 46, 43, 0.3);
}

.product-content {
    padding: 1.5rem;
}

.product-name {
    font-size: 1.3rem;
    font-weight: bold;
    color: #4B2E2B;
    margin-bottom: 0.8rem;
    height: 2.6rem;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
}

.product-price {
    font-size: 1.2rem;
    font-weight: bold;
    color: #7B3F00;
    margin-bottom: 1rem;
}

.ai-reason {
    background: linear-gradient(135deg, #F3E9DC, #FFF8F0);
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    border-right: 4px solid #7B3F00;
    position: relative;
}

.ai-reason::before {
    content: "ğŸ¤–";
    position: absolute;
    top: -5px;
    right: -5px;
    font-size: 1.5rem;
}

.reason-text {
    font-size: 0.95rem;
    color: #4B2E2B;
    margin: 0;
    font-style: italic;
}

.view-product-btn {
    display: block;
    width: 100%;
    background: linear-gradient(45deg, #4B2E2B, #7B3F00);
    color: #FFF8F0;
    text-align: center;
    padding: 15px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(75, 46, 43, 0.3);
    border: none;
    cursor: pointer;
}

.view-product-btn:hover {
    background: linear-gradient(45deg, #7B3F00, #C97C5D);
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(75, 46, 43, 0.4);
    color: #FFF8F0;
}

.trending-section {
    background: white;
    padding: 3rem;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(75, 46, 43, 0.1);
    margin-top: 3rem;
    border: 3px solid #F3E9DC;
}

.section-title {
    font-size: 2.2rem;
    font-weight: bold;
    color: #4B2E2B;
    text-align: center;
    margin-bottom: 2rem;
    position: relative;
}

.section-title::after {
    content: '';
    display: block;
    width: 100px;
    height: 4px;
    background: linear-gradient(45deg, #4B2E2B, #7B3F00);
    margin: 1rem auto;
    border-radius: 2px;
}

.trending-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
}

.trending-item {
    background: #FFF8F0;
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    transition: all 0.3s ease;
    border: 2px solid transparent;
}

.trending-item:hover {
    background: #F3E9DC;
    border-color: #7B3F00;
    transform: translateY(-5px);
}

.trending-name {
    font-weight: bold;
    color: #4B2E2B;
    margin-bottom: 0.5rem;
}

.trending-price {
    color: #7B3F00;
    font-weight: 600;
}

.no-recommendations {
    text-align: center;
    padding: 4rem 2rem;
    background: white;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(75, 46, 43, 0.1);
}

.no-recommendations-icon {
    font-size: 5rem;
    margin-bottom: 1rem;
}

.no-recommendations-title {
    font-size: 1.8rem;
    color: #4B2E2B;
    margin-bottom: 1rem;
}

.no-recommendations-text {
    color: #7B3F00;
    line-height: 1.6;
    max-width: 500px;
    margin: 0 auto 2rem;
}

.explore-btn {
    display: inline-block;
    background: linear-gradient(45deg, #4B2E2B, #7B3F00);
    color: #FFF8F0;
    padding: 15px 30px;
    border-radius: 25px;
    text-decoration: none;
    font-weight: bold;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(75, 46, 43, 0.3);
}

.explore-btn:hover {
    background: linear-gradient(45deg, #7B3F00, #C97C5D);
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(75, 46, 43, 0.4);
    color: #FFF8F0;
}

@media (max-width: 768px) {
    .page-title {
        font-size: 2.2rem;
    }
    
    .recommendations-grid {
        grid-template-columns: 1fr;
        gap: 1.5rem;
    }
    
    .trending-section {
        padding: 2rem 1.5rem;
    }
    
    .stats-cards {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>
{% endblock %}

{% block content %}
<div class="recommendations-page">
    <div class="container" style="max-width: 1400px; margin: 0 auto; padding: 0 2rem;">
        
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">ğŸ§  {{ page_title }}</h1>
            <p class="page-subtitle">
                Ø³ÛŒØ³ØªÙ… Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ù…Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ­Ù„ÛŒÙ„ Ø±ÙØªØ§Ø±ØŒ Ø³Ù„ÛŒÙ‚Ù‡ Ùˆ ØªØ§Ø±ÛŒØ®Ú†Ù‡ Ø®Ø±ÛŒØ¯Ù‡Ø§ÛŒ Ø´Ù…Ø§ØŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
            </p>
        </div>

        <!-- Statistics Cards -->
        {% if stats %}
        <div class="stats-cards">
            <div class="stat-card">
                <div class="stat-number">{{ stats.total_recommendations|default:0 }}</div>
                <div class="stat-label">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ ÙØ¹Ø§Ù„</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.viewed_count|default:0 }}</div>
                <div class="stat-label">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø´Ø¯Ù‡</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">{{ stats.view_rate|floatformat:0|default:0 }}%</div>
                <div class="stat-label">Ù†Ø±Ø® Ù…Ø´Ø§Ù‡Ø¯Ù‡</div>
            </div>
        </div>
        {% endif %}

        <!-- Main Recommendations -->
        {% if recommendations %}
        <div class="recommendations-grid">
            {% for item in recommendations %}
            <div class="recommendation-item">
                <div class="product-image">
                    {% if item.product.image %}
                        <img src="{{ item.product.image.url }}" alt="{{ item.product.name }}">
                    {% else %}
                        <div style="width: 100%; height: 100%; background: linear-gradient(45deg, #4B2E2B, #7B3F00); display: flex; align-items: center; justify-content: center; color: #FFF8F0; font-size: 4rem;">â˜•</div>
                    {% endif %}
                    <div class="ai-score-badge">
                        {{ item.score|floatformat:1 }}â˜… AI
                    </div>
                </div>
                <div class="product-content">
                    <h3 class="product-name">{{ item.product.name }}</h3>
                    <p class="product-price">{{ item.product.price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</p>
                    <div class="ai-reason">
                        <p class="reason-text">{{ item.reason }}</p>
                    </div>
                    <a href="{% url 'product_detail' item.product.id %}" class="view-product-btn" onclick="trackRecommendationView({{ item.product.id }})">
                        Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù…Ø­ØµÙˆÙ„
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="no-recommendations">
            <div class="no-recommendations-icon">ğŸ¤–</div>
            <h2 class="no-recommendations-title">Ù‡Ù†ÙˆØ² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ù†Ø¯Ø§Ø±ÛŒÙ…</h2>
            <p class="no-recommendations-text">
                Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø´Ø®ØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡ØŒ Ø§Ø¨ØªØ¯Ø§ Ú†Ù†Ø¯ Ù…Ø­ØµÙˆÙ„ Ø±Ø§ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ú©Ù†ÛŒØ¯ Ùˆ Ø³Ù„ÛŒÙ‚Ù‡ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù‡ Ù…Ø§ Ù†Ø´Ø§Ù† Ø¯Ù‡ÛŒØ¯
            </p>
            <a href="{% url 'product_list' %}" class="explore-btn">Ú©Ø§ÙˆØ´ Ù…Ø­ØµÙˆÙ„Ø§Øª</a>
        </div>
        {% endif %}

        <!-- Trending Products Section -->
        {% if trending_products %}
        <div class="trending-section">
            <h2 class="section-title">ğŸ”¥ Ù…Ø­ØµÙˆÙ„Ø§Øª Ù…Ø­Ø¨ÙˆØ¨</h2>
            <div class="trending-grid">
                {% for product in trending_products %}
                <div class="trending-item">
                    <div class="trending-name">{{ product.name }}</div>
                    <div class="trending-price">{{ product.price|floatformat:0 }} ØªÙˆÙ…Ø§Ù†</div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

    </div>
</div>

<script>
// Track recommendation views for analytics
function trackRecommendationView(productId) {
    fetch(`/shop/track-recommendation/${productId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Content-Type': 'application/json',
        },
    }).catch(error => console.log('Analytics tracking failed:', error));
}

// Add loading animation to cards
document.addEventListener('DOMContentLoaded', function() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Initially hide cards for animation
    document.querySelectorAll('.recommendation-item, .stat-card').forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(30px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });
});
</script>
{% endblock %}